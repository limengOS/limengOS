<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>L4Re – L4 Runtime Environment: l4vio_net_p2p, a virtual network point-to-point link</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="l4re.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">L4Re – L4 Runtime Environment
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('l4re_servers_virtio_net_p2p.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">l4vio_net_p2p, a virtual network point-to-point link </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The virtual network point-to-point server (p2p) connects two clients with a virtual network connection.</p>
<p>It uses virtio as the transport mechanism. Each virtual network p2p endpoint implements the device-side of a virtio network device. Each client can access its endpoint using the driver-side semantics of a virtio network device.</p>
<h2>Building and Configuration</h2>
<p>The virtual network p2p server can be built using the <a class="el" href="namespaceL4Re.html" title="L4Re C++ Interfaces.">L4Re</a> build system by placing this project into the <code>pkg</code> directory.</p>
<h2>Starting the service</h2>
<p>The virtual network p2p server can be started with Lua like this: </p><pre class="fragment">local p2p = L4.default_loader:new_channel();
L4.default_loader:start(
{
  caps = {
    svr = p2p:svr(),
  },
},
"rom/l4vio_net_p2p [&lt;options&gt;]");
</pre><p> First an IPC gate (<code>p2p</code>) is created which is used between the virtual network p2p server and a client to create new virtual ports. The server-side is assigned to the mandatory <code>svr</code> capability of the virtual network p2p server. See the section below on how to create a new virtual port and connect a client to it.</p>
<h3>Options</h3>
<p>The following command line options are supported:</p>
<ul>
<li><p class="startli"><code>-p &lt;num_usec&gt;</code>, <code>--poll &lt;num_usec&gt;</code></p>
<p class="startli">Enable polling mode and set the poll interval. IRQ notification is disabled for queues while in polling mode. Must be a positive integer specified in microseconds.</p>
</li>
<li><p class="startli"><code>-s &lt;num&gt;</code>, <code>--size &lt;num&gt;</code></p>
<p class="startli">Set the maximum queue size for the device-side virtio queues. Must be a power of 2 in the range of 1 to 32768 inclusive.</p>
</li>
</ul>
<h2>Connecting a client</h2>
<p>Prior to connecting a client to a virtual network p2p server port it has to be created using the following Lua function. It has to be called on the client side of the IPC gate capability whose server side is bound to the virtual network p2p server.</p>
<p>The "key=value" pairs passed to create() can be omitted and their order is not important. </p><pre class="fragment">create(obj_type, ["ds-max=&lt;max&gt;" , "mac-addr=&lt;mac_address&gt;"])
</pre><ul>
<li><p class="startli"><code>obj_type</code></p>
<p class="startli">The type of object that should be created by the server. The type must be a positive integer. Currently the following objects are supported:</p><ul>
<li><code>0</code>: Virtual p2p port</li>
</ul>
</li>
<li><p class="startli"><code>"ds-max=&lt;max&gt;"</code></p>
<p class="startli">Specifies the upper limit of the number of dataspaces the client is allowed to register with the server for virtio DMA. Must be in the range of 1 to 80 inclusive. The default value is 2.</p>
</li>
<li><p class="startli"><code>"mac-addr=&lt;mac_address&gt;"</code></p>
<p class="startli">Specify the MAC address of the endpoint where &lt;mac_address&gt; is of the form X:XX:Xx:x:xx:xX.</p>
</li>
</ul>
<p>If the <code>create()</code> call is successful a new capability which references a virtual network p2p server port is returned. A client uses this capability to talk to the virtual network p2p server using the virtio network protocol.</p>
<p>A couple of examples on how to create ports with different properties are listed below. </p><pre class="fragment">-- two normal ports with at most 4 data spaces
net0 = p2p:create(0, "ds-max=4")
net1 = p2p:create(0, "ds-max=4")
-- normal port with 4 data spaces and MAC address
net0 = p2p:create(0, "ds-max=4", "mac-addr=11:22:33:44:55:66")
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="l4re_servers.html">L4Re Servers</a></li>
    <li class="footer">Generated on Mon Apr 18 2022 20:48:54 for L4Re – L4 Runtime Environment by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
